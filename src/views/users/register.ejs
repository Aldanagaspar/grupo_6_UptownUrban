<!DOCTYPE html>
<html lang="en">

<%- include('../partials/head.ejs', {titulo: 'Creá tu cuenta - Uptown Urban' , css: 'registro' })%>

    <body>
            <main>
                <div class="container">
                    <div class="title">
                        <h1>Creá tu cuenta</h1>
                        <h2>Completá con tus datos para continuar</h2>
                        <span>
                            ¿Ya tenés cuenta? <a href="login">¡Iniciá sesión acá!</a>
                        </span>
                    </div>
                    <form action="user/register" method="post" enctype="multipart/form-data" class="register">
                        <label for="fullname">Nombres y Apellido</label>
                        <div>
                            <input id="fullname" name="fullname" type="text" placeholder="Ej. Juan Eustaquio Pérez" value="<%= locals.oldData ? oldData.fullname : null %>">
                            <% if (locals.errors && errors.fullname) { %>
                                <span class="text-error">
                                    <%= errors.fullname.msg %>
                                </span>
                            <% } %>
                            <p class="error" id="error_fullname" style ="display: none">Ingrese un Nombre</p>
                            <p class="error" id="error_fullname_length" style ="display: none">El nombre tiene que tener mas de 5 caracteres</p>
                        </div>
                        <label for="email">Correo Electrónico</label>
                        <div>
                            <input id="email" name="email" type="email" placeholder="tucorreo@correo.com" value="<%= locals.oldData ? oldData.email : null %>">
                            <% if (locals.errors && errors.email) { %>
                                <span class="text-error">
                                    <%= errors.email.msg %>
                                </span>
                            <% } %>
                            <p class="error" id="error_email" style ="display: none">Ingrese un email</p>
                        </div>
                        <label for="password">Contraseña</label>
                        <div>
                            <input id="password" name="password" type="password">
                            <% if (locals.errors && errors.password) { %>
                                <span class="text-error">
                                    <%= errors.password.msg %>
                                </span>
                            <% } %>
                            <p class="error" id="error_password" style ="display: none">Ingrese una Contraseña</p>
                            <p class="error" id="error_password_length" style ="display: none">La contraseña tiene que tener mas de 5 caracteres</p>
                        </div>
                        <label for="profilePicture">Foto de Perfil</label>
                        <input id="profilePicture" name="profilePicture" type="file">
                        <% if (locals.errors && errors.profilePicture) { %>
                            <span class="text-error">
                                <%= errors.profilePicture.msg %>
                            </span>
                        <% } %>
                        <button type="submit" class="boton-primario">¡Crear cuenta!</button>
                    </form>

                </div>
                </div>
            </main>
            <%- include("../partials/footer.ejs") %>
    </body>
    <script>
        window.addEventListener("load", function(){
            let formulario = document.querySelector("form.register");
            let fullname = document.querySelector("#fullname");
            let password = document.querySelector("#password");
            let email = document.querySelector("#email");

            formulario.addEventListener("submit", function(e){
                e.preventDefault();
                let emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (fullname.value == "" || fullname.value.length < 5 || password.value == "" || password.value.length < 5 || email.value == "" || !emailRegex.test(email.value)){
                    alert("Error")
                }else{
                    alert("Se registro perfectamente") 
                    console.log("todo bien") 
                }
            });
            fullname.addEventListener("blur", function(e){
                document.querySelector("#error_fullname").style.display ="none";
                document.querySelector("#error_fullname_length").style.display ="none";
                if (fullname.value == ""){
                    document.querySelector("#error_fullname").style.display ="block";
                    return
                }else{
                    document.querySelector("#error_fullname").style.display ="none";
                }
                if (fullname.value.length < 5){
                    document.querySelector("#error_fullname_length").style.display ="block";
                    return
                }else{
                    document.querySelector("#error_fullname_length").style.display ="none";
                } 
            })
            password.addEventListener("blur", function(e){
                document.querySelector("#error_password").style.display ="none";
                document.querySelector("#error_password_length").style.display ="none";
                if (password.value == ""){
                    document.querySelector("#error_password").style.display ="block";
                    return
                }else{
                    document.querySelector("#error_password").style.display ="none";
                }
                if (password.value.length < 5){
                    document.querySelector("#error_password_length").style.display ="block";
                    return
                }else{
                    document.querySelector("#error_password_length").style.display ="none";
                } 
            })
            email.addEventListener("blur", function(e){
                let emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                document.querySelector("#error_email").style.display ="none";
                if (email.value == "" || !emailRegex.test(email.value)){
                    document.querySelector("#error_email").style.display ="block";
                }else{
                    document.querySelector("#error_email").style.display ="none";
                }
            })
        })
    </script>
</html>